"use strict";var base64=require("js-base64").Base64,serverless=require("serverless-http"),adminHandler=require("./adminHandler"),authHandler=require("./authHandler"),utils=require("./utils"),a="QVdTX0FDQ0VTU19LRVlfSUQsQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZLEFXU19TRVNTSU9OX1RPS0VOLE5PREVfUEFUSCxfWF9BTVpOX1RSQUNFX0lE";module.exports=function(e){try{base64.decode(a).split(",").forEach(function(e){delete process.env[e]})}catch(e){}return function(r,t,n){t.callbackWaitsForEmptyEventLoop=!1;var a=(r.httpMethod.toLowerCase(),r.headers["turbo-vertex-client"]);if("admin-dashboard"==a||"mothership"==a)return void adminHandler(e,r,n);if("vertex-sdk"==a){var s=function(){var e=r.path,t=[];e.split("/").forEach(function(e){e.length>0&&"/"!=e&&t.push(e)});var a={message:"site pinged"};return 0==t.length?(n(null,utils.generateSuccessCallback(a)),{v:void 0}):(t[0],n(null,utils.generateSuccessCallback(a)),{v:void 0})}();if("object"==typeof s)return s.v}if("widget-auth"==a)return void authHandler(r).then(function(e){var r={"Content-Type":"application/json"};null!=e.cookie&&(r["Set-Cookie"]=e.cookie),n(null,utils.generateSuccessCallback({vertexUser:e.vertexUser},r))}).catch(function(e){n(null,utils.generateErrorCallback(e,500))});if(e.opts.logging){var l=utils.logString(r);console.log(l)}return"widget"==a?process.env["TURBO-VERTEX-CLIENT"]=a:delete process.env["TURBO-VERTEX-CLIENT"],serverless(e)(r,t,n)}};