"use strict";var express=require("express"),path=require("path"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),sessions=require("client-sessions"),templateEngine=require("./template-engine"),db=require("./db"),BASE_PATH=__dirname+"/../../../../",configureSession=function(e){var s=e.opts;if(s.session){var o=s.session.cookieName||"vertexSession",r=s.session.secret||process.env.SESSION_SECRET,n=s.session.duration||864e5,i=s.session.activeDuration||18e5;e.use(sessions({cookieName:o,secret:r,duration:n,activeDuration:i}))}},configureDB=function(e){var s=e.opts.db;s&&(null==s.type?db.connect(s.url,s.onError,s.onSuccess):"mongo"==s.type?db.connectMongo(s.url,s.onError,s.onSuccess):"nedb"==s.type?db.connectNedb(s.url,s.onError,s.onSuccess):db.connectMongo(s.url,s.onError,s.onSuccess))};module.exports=function(e,s){if(null!=e){e.opts=s||{},e.use(bodyParser.json()),e.use(bodyParser.urlencoded({extended:!1})),e.use(cookieParser()),e.use(logger("dev")),e.opts.viewEngine?e.set("view engine",e.opts.viewEngine):(e.set("view engine","mustache"),e.engine("mustache",templateEngine.__express));var o=e.opts.views?path.join(BASE_PATH,e.opts.views):path.join(BASE_PATH,"views");e.set("views",o);var r=e.opts.static||"public",n=path.join(BASE_PATH,r),i=process.env.TURBO_CDN;if(null!=i&&"prod"===process.env.TURBO_ENV){var t={dotfiles:"ignore",etag:!1,setHeaders:function(e,s,o){var n=i+s.replace("/var/task/"+r,"");e.status(302),e.set("Location",n)}};e.use(express.static(n,t))}else e.use(express.static(n));null!=e.opts.session&&configureSession(e),null!=e.opts.db&&configureDB(e)}};