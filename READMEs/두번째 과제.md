# Blog 기능을 갖춘 서버 구축해보기
> [2020.02.24 ~ 03.03]🔌

## 📌 사전 준비 사항

npm 설치 방법 및 Express 프로젝트 구조에 대해 학습해오기 

<br/>

## ☝️ 1. **간단한 블로그 튜토리어 따라하기**
- 참고 | [Beginner Node JS & Express - Blog Website | All](https://www.youtube.com/watch?v=iONugkYM2rs)

1. terminal 연다.
2. sudo npm install -g turbo-cli 명령어 입력해서 turbo 설치한다.
3. turbo version 명령어 입력해서 버전 확인해본다. ex) 0.38.1

<img width="850" alt="스크린샷 2020-03-03 오전 12 18 21" src="https://user-images.githubusercontent.com/44978839/75696263-a5b07c00-5cee-11ea-8311-a77584f2ba0d.png">

4. [turbo 사이트 접속](https://www.turbo360.co/site/blog-tutorial-mv3m1d)
5. gallery > Developers > turbo360 검색해서 블로그 튜토리얼 템플릿 프로젝트를 찾는다.
6. Download Source 클릭한다.
7. turbo에 회원가입을 한다. *이메일 인증은 덤*
8. 다운받은 blog-tutorial 패키지를 편한 디렉토리로 옮겨 압축을 푼다.
9. 압축 푼 파일들 중에서 node modules 를 지운다
10. terminal 로 다시 가서 blog-tutorial 프로젝트 폴더 안으로 들어간다.
11. 삭제한 dependency 를 reinstall 하고 싶다.

> 여기서 잠깐 !
- 어떤 dependency 를 설치해야하는지 알 수 있을까?
- 뭘 다운로드 받아야할 지 physical한, actual한 dependency list 말야!
* 확인하는 방법은 바로 **package.json** : very important concept

12. VScode로 blog-tutorial 프로젝트를 연다.
13. npm install을 하면 package.json 에서 dependencies 를 찾아 다운로드한다.
14. npm 을 실행하려면 그러면 어떻게 해야하나? 당연히 npm run serve
15. 그럼 이제 localhost에 접속하면 똑같은 홈페이지를 볼 수 있다!

<img width="850" alt="스크린샷 2020-03-03 오전 12 43 44" src="https://user-images.githubusercontent.com/44978839/75696481-0049d800-5cef-11ea-8c9c-eacad6f547ac.png">

## ☝️ 2. **프로젝트 구조 파악 및 개념 학습**
1. app.js의 가장 중요한 역할은 routes다.
> 여기서 잠깐 !
- set routes라는 의미는?
* routes > page 들어가면 홈페이지를 핸들링 하는 것들이 들어있다.

2. home.mustache는 실제 데이타가 들어있는 html 형식의 데이타다. views에 들어가면 존재하는데, 페이지를 보여주기 위해 렌더링하는 object다.
3. {{<head}} 이 독특한 표기법은? mustache template engine. 바로 partial : to reuse html, 어느 페이지를 들어가도 반복되는 부분이다. ex) 헤더 푸터
4. {{#posts}} ~ {{/posts}} 에 있는 코드를 한번 썼지만 4번 반복해서 렌더링되어 block 을 post한다. 5번, 20번, n번 반복 가능하다. (27:00)
5. 이 부분이 없다면? 본문이 아예 없고, 즉 블로그의 포스팅 부분이 사라지고 헤더만 있는 상태가 된다.
6. postCtr.get() 는 무슨 일이 일어날까? getting the post from 'sth'. Sth is post. 블로그 포스트를 Fetch 해오는 부분이다.
7. 이 posts의 실제 데이타는 어디서부터 오는 것일까? Local database 이다. ex) Mongo
8. 그렇다면 posts의 db는 어디에 있을까? tmp : temporary db 파일을 찾을 수 있다. post.db 파일 안에 들어가보면 4개의 데이타가 있는데 이 데이타들은 JSON object 형태이다. Mongo 데이타베이스는 raw JSON 형태로 데이타를 저장한다. title, text 와 같은 주요한 키들로 구성된다.
9. [JSON formatter](https://jsonformatter.curiousconcept.com) 사이트에 들어가서 이 JSON 코드를 복사한 다음에 생성해보면 formatted 된 형태를 확인할 수 있다. 간단한 로직으로 데이타를 저장하는 통상적인 방법이다.

<img width="850" alt="스크린샷 2020-03-03 오후 8 58 21" src="https://user-images.githubusercontent.com/44978839/75773851-0cd33c80-5d92-11ea-8df4-599a819ba3f1.png">

10. Controllers 의 컨셉은 데이타베이스와 실제로 소통하는 툴이다. 우리는 할 수 있는 한 최대한 M(데이타), V(뷰의 로직), C(연결자)를 분리하는 것이 좋다.
11. Model : references to the View. models 에 들어가면 블로그 포스트인 Post.js 가 있는데, 모든 attributes 를 볼 수 있다. 모두 key 고 JSON 형태로 되어있다. 중요한 컨셉은, 뷰와 관련된 reference 가 절대 없다는 것이다. ex) html 예를 들어, 아래와 같은 구문은 좋지 않다.

```JSON
template: {type : String, default: "home.mustache"} 
``` 

12. afterwards, 로컬 주소 뒤에 있는 것들 를 "path" 라고 부르는데, 어떤 라우트가 로직을 핸들링할 것인지를 결정한다. 당연히 다른 뷰를 렌더링한다.

> 여기서 잠깐 !
* nodemon 을 사용 중에 새벽에 서버를 돌리고 나서, 전원을 종료했다가 다시 프로젝트를 npm run serve 해보니 다음과 같은 에러가 발생했다.

```
Error: listen EADDRINUSE: address already in use :::3000
```

- 로컬 포트에서 어떤 프로세스들이 동작하고 있는지 확인하기 위한 명령어를 입력한다.

```
$ lsof -i tcp:3000
```

- 입력 후 해당 포트에서 실행 중인 프로세스들을 확인한다.

```
COMMAND  PID     USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
node    5981 ttub_nii   22u  IPv6 0xa975cb6f2489cf3f      0t0  TCP *:hbci (LISTEN)
```

- 강제 종료할 PID를 확인한 후 PID 자리에 다음과 같이 입력한다.

```
$ kill -9 5981
```
