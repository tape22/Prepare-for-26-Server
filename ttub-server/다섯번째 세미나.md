# node.js의 구조와 동작원리
> [2020.02.19] 네번쨰 세미나 추가 정리

## 📌 사전 준비 사항

과제가 나갈 예정이므로 마음의 준비 단디 하기

<br/>

1. **node.js 란?**

비동기 이벤트 기반 javascript 런타임 환경으로, 단일스레드, 이벤트 루프를 통한 높은 처리 성능을 가지고 있다.
- 참고 | [Node.js 공식 문서](https://nodejs.org/ko/docs/)

- node.js는 비동기 기반이다.

Node.js에서 libuv를 사용하는 Node.js 표준 라이브러리의 동기 메서드 외에 Node.js 표준 라이브러리의 모든 I/O 메서드는 논블로킹인 비동기 방식을 제공하고 콜백 함수를 받는다. (네이티브 모듈도 블로킹 메서드를 가질 수 있습니다. (이런 동기 메서드는 이름 마지막에 Sync가 붙습니다.)  
<img width="1440" alt="스크린샷 2020-02-19 오후 11 08 43" src="https://user-images.githubusercontent.com/44978839/74842094-2a091380-536d-11ea-81b6-dcf78cbb67f4.png">

 > [출처] 정민쌤의 03. REST API와 Node.js 
 
  - 블로킹: 호출되는 함수가 자신의 작업을 마칠 때까지 제어권을 넘겨주지 않고 대기하는 방식
  - 논블로킹: 호출되는 함수가 바로 제어권을 넘겨줘서 다른 작업을 진행할 수 있도록 하는 방식

따라서 아래와 같은 상황에서 func2 메서드가 Web API에 setTimeout()이라는 시간 지연 함수를 요청하는 동안 func3이 실행되고(비동기), 마지막으로 func2 메서드가 실행되면서 콜백 함수로 전달된다.  
<img width="1440" alt="스크린샷 2020-02-19 오후 11 14 57" src="https://user-images.githubusercontent.com/44978839/74842384-abf93c80-536d-11ea-9536-2c2e090625ac.png">

 > [출처] 정민쌤의 03. REST API와 Node.js 
 
 <br/>

- node.js는 싱글 스레드에서 동작한다.

<img width="1440" alt="스크린샷 2020-02-19 오후 11 18 26" src="https://user-images.githubusercontent.com/44978839/74842689-2629c100-536e-11ea-8c5d-fc97b8dd7923.png">

 > [출처] 정민쌤의 03. REST API와 Node.js 

- 이벤트 루프를 통한 높은 처리 성능을 가진다.


1. **Express란 무엇인가?**
  > Fast, unopinionated, minimalist web framework for Node.js
   
   node.js의 웹 어플리케이션 프레임워크로, 위키에서는 node.js의 사실상 표준 서버 프레임워크라고 말한다.
  
   * 참고 | [node.js의 인기 프레임워크 비교하기](https://www.smoh.kr/m/203)
   
     - [Express] node.js의 클래식. 빠르고 간단하고 유연하다. 개발자에게 많은 자유를 제공한다.
     - [Meteor] 범용적이며 풀스택. Angular 또는 React와 통합되어 back-front 응용 프로그램을 연결한다.
     - [Routes] REST API 프레임워크의 대표. 사용자 인증 및 권한 작성에 적합. API를 쉽고 빠르게 작성할 수 있다.

<br/>

2. **Express 설치하기**

개발에 필요한 폴더와 파일등, 스켈레톤이 잡혀있는 프로젝트를 생성하려면 express-generator 모듈을 사용해야 한다.

* 참고 | [express-generator와 미들웨어 개념](https://victorydntmd.tistory.com/23)

  ```javascript
  npm install –g express express-generator
  ```
  
  - express-generator 모듈은 내장 모듈이 아니므로, npm을 통해 모듈을 설치해야한다.
  - g 옵션은 global을 의미한다. global로 설치한 모듈은 커맨더 창 어디에서든 명령어를 실행할 수 있으므로, express-generator 모듈을 설치하면 커맨더 창에서 express라는 키워드를 사용할 수 있습니다.


 <img width="600" alt="스크린샷 2020-02-19 오후 4 11 00" src="https://user-images.githubusercontent.com/44978839/74810321-76832d80-5332-11ea-87f9-1caf78ac85c8.png">
 
 > [출처] 정민쌤의 02.node.js express로 환경 세팅하기
 
<br/>
 
3. **프로젝트 생성하기**

express-generator로 serverTest 이름의 스켈레톤 애플리케이션을 생성한다.
  
  ```
   'express'은(는) 내부 또는 외부 명령, 실행할 수 있는 프로그램, 또는 배치 파일이 아닙니다.
  ```
  
- 이와 같은 에러가 발생하는 이유는, -g 옵션으로 설치한 npm에 대한 경로가 환경변수로 잡혀 있어야 한다.
- C:\Users\{사용자이름}\AppData\Roaming\npm 경로를 시스템 환경 변수의 Path로 설정한다.
- Webstorm 터미널에서 실행한다면, 환경 변수 설정 후 Webstorm을 재시작한다.

<br/>

4. **npm 설치하기**

npm을 설치할 때는 생성한 express 폴더 안으로 들어가서 설치해야한다.

 - npm install은 모듈을 설치할 때 사용하는 명령어다. 
 
  ```javascript
  cd serverTest
  npm install
 ```
 
 <br/>
 
 - package.json 파일에 dependencies 프로퍼티에 모듈들이 정의되어 있는데, 이 모듈들은 express-generator가 생성한 것이다.
 - npm install 명령어를 실행하면, package.json 파일의 dependencies 프로퍼티를 보고 모듈을 설치한다.
 - 즉, dependencies 에는 모듈을 사용하겠다고 선언만 한 것이고, 진짜로 설치를 하려면 npm install을 해주어야 한다.
 
 ```
 package.json
 
 {
  "name": "2020",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "start": "node ./bin/www"
  },
  "dependencies": {
    "cookie-parser": "~1.4.4",
    "debug": "~2.6.9",
    "express": "~4.16.1",
    "http-errors": "~1.6.3",
    "jade": "~1.11.0",
    "morgan": "~1.9.1",
    "nodemon": "^2.0.2"
  }
}
```
 
 <br/>

5. **서버 실행하기**

- 생성한 serverTest 폴더 안에서 npm start 명령어를 입력하여 설치한다.

 ```javascript
  npm start
 ```
 
 <br/>
 
 - http://localhost:3000 로 접근하면 다음과 같은 화면을 볼 수 있다.
 
 <img width="1440" alt="스크린샷 2020-02-19 오후 4 21 01" src="https://user-images.githubusercontent.com/44978839/74810953-d75f3580-5333-11ea-868a-e7df4477d724.png">

 > [출처] 정민쌤의 02.node.js express로 환경 세팅하기

<br/>

 - 아래와 같이 nodemon을 사용하면 앞으로 파일을 수정할 때마다 저장하고 npm start를 하지 않아도 자동 새로고침이 된다.
 
 ```javascript
  npm install  nodemon
 ```

<br/>

## 📌 다음 목차
- [여섯번째 세미나: ]
